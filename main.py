import os
from dotenv import load_dotenv
from elasticsearch import Elasticsearch
import httpx
import json

load_dotenv()

YA_REGIONS = {
    "11339": "Абаза",
    "1095": "Абакан",
    "11194": "Агаповка",
    "11233": "Агинское",
    "11005": "Адыгейск",
    "11120": "Азнакаево",
    "11030": "Азов",
    "11031": "Аксай",
    "11432": "Алдан",
    "11234": "Алейск",
    "11142": "Александров Гай",
    "10656": "Александров",
    "11347": "Александровское",
    "11444": "Александровск-Сахалинский",
    "10948": "Алексеевская",
    "10825": "Алексин",
    "11471": "Алушта",
    "11121": "Альметьевск",
    "10903": "Амдерма",
    "11451": "Амурск",
    "11458": "Анадырь",
    "1107": "Анапа",
    "11256": "Ангарск",
    "11276": "Анжеро-Судженск",
    "10686": "Анна",
    "10894": "Апатиты",
    "10715": "Апрелевка",
    "10986": "Апшеронск",
    "11195": "Аргаяш",
    "11025": "Аргун",
    "11080": "Арзамас",
    "10987": "Армавир",
    "11405": "Арсеньев",
    "11406": "Артём",
    "20": "Архангельск",
    "11373": "Архара",
    "11160": "Асбест",
    "37": "Астрахань",
    "11302": "Ачинск",
    "11196": "Аша",
    "11032": "Багаевская",
    "11257": "Байкальск",
    "11331": "Бай-Хаак",
    "10657": "Балакирево",
    "11143": "Балаково",
    "10716": "Балашиха",
    "11144": "Балашов",
    "10858": "Балтийск",
    "197": "Барнаул",
    "11154": "Барыш",
    "11033": "Батайск",
    "10905": "Батецкий",
    "10927": "Бежаницы",
    "10804": "Бежецк",
    "11034": "Белая Калитва",
    "4": "Белгород",
    "11096": "Белинский",
    "11277": "Белово",
    "11374": "Белогорск",
    "11236": "Белокуриха",
    "10938": "Беломорск",
    "10988": "Белореченск",
    "11258": "Белореченский",
    "11179": "Белоярский",
    "11314": "Бердск",
    "11278": "Берёзовский",
    "11023": "Беслан",
    "11097": "Бессоновка",
    "975": "Бийск",
    "11459": "Билибино",
    "11393": "Биробиджан",
    "11259": "Бирюсинск",
    "11238": "Благовещенка",
    "77": "Благовещенск",
    "11054": "Благодарный",
    "10673": "Бобров",
    "10674": "Богучар",
    "11260": "Бодайбо",
    "10861": "Бокситогорск",
    "10805": "Бологое",
    "10768": "Болхов",
    "11407": "Большой Камень",
    "11355": "Борзя",
    "10675": "Борисоглебск",
    "10906": "Боровичи",
    "10698": "Боровск",
    "976": "Братск",
    "11197": "Бреды",
    "10717": "Бронницы",
    "191": "Брянск",
    "11122": "Бугульма",
    "11085": "Бугуруслан",
    "11055": "Будённовск",
    "11086": "Бузулук",
    "10700": "Буй",
    "11006": "Буйнакск",
    "11376": "Бурея",
    "10676": "Бутурлиновка",
    "10907": "Валдай",
    "11452": "Ванино",
    "11198": "Варна",
    "10781": "Велиж",
    "10928": "Великие Луки",
    "24": "Великий Новгород",
    "10854": "Великий Устюг",
    "10843": "Вельск",
    "10826": "Венёв",
    "10862": "Верево",
    "11402": "Верхнее Пенжино",
    "11199": "Верхнеуральск",
    "11200": "Верхний Уфалей",
    "11161": "Верхняя Салда",
    "11433": "Верхоянск",
    "11279": "Верх-Чебула",
    "10806": "Весьегонск",
    "11035": "Вёшенская",
    "10719": "Видное",
    "11434": "Вилюйск",
    "11395": "Вилючинск",
    "10989": "Витязево",
    "11262": "Вихоревка",
    "10688": "Вичуга",
    "75": "Владивосток",
    "33": "Владикавказ",
    "192": "Владимир",
    "11408": "Владимиро-Александровское",
    "10720": "Внуково",
    "38": "Волгоград",
    "11036": "Волгодонск",
    "10701": "Волгореченск",
    "10951": "Волжский",
    "21": "Вологда",
    "10721": "Волоколамск",
    "10863": "Волосово",
    "10908": "Волот",
    "10864": "Волхов",
    "11410": "Вольно-Надеждинское",
    "11145": "Вольск",
    "10940": "Воркута",
    "193": "Воронеж",
    "10722": "Воскресенск",
    "11149": "Воткинск",
    "10865": "Всеволожск",
    "969": "Выборг",
    "10807": "Вышний Волочёк",
    "10659": "Вязники",
    "10782": "Вязьма",
    "10783": "Гагарин",
    "11087": "Гай",
    "10703": "Галич",
    "10867": "Гатчина",
    "10990": "Геленджик",
    "11056": "Георгиевск",
    "11150": "Глазов",
    "11319": "Горно-Алтайск",
    "11239": "Горняк",
    "10952": "Городище",
    "10660": "Гороховец",
    "10991": "Горячий Ключ",
    "1106": "Грозный",
    "10646": "Губкин",
    "11228": "Губкинский",
    "11026": "Гудермес",
    "11037": "Гуково",
    "11280": "Гурьевск",
    "11326": "Гусиноозерск",
    "10661": "Гусь-Хрустальный",
    "10992": "Дагомыс",
    "11411": "Дальнегорск",
    "11412": "Дальнереченск",
    "10835": "Данилов",
    "10953": "Даниловка",
    "10784": "Демидов",
    "10913": "Демянск",
    "11007": "Дербент",
    "10785": "Десногорск",
    "972": "Дзержинск",
    "11303": "Дивногорск",
    "11345": "Диксон",
    "11155": "Димитровград",
    "10706": "Дмитриев",
    "10723": "Дмитров",
    "10929": "Дно",
    "11201": "Долгодеревенское",
    "214": "Долгопрудный",
    "11016": "Домбай",
    "10725": "Домодедово",
    "10827": "Донской",
    "10786": "Дорогобуж",
    "215": "Дубна",
    "10954": "Дубовка",
    "11344": "Дудинка",
    "10787": "Духовщина",
    "10651": "Дятьково",
    "11463": "Евпатория",
    "11039": "Егорлыкская",
    "10727": "Егорьевск",
    "10993": "Ейск",
    "54": "Екатеринбург",
    "11377": "Екатеринославка",
    "11123": "Елабуга",
    "10955": "Елань",
    "10713": "Елец",
    "11396": "Елизово",
    "10788": "Ельня",
    "11304": "Енисейск",
    "11263": "Ербогачён",
    "11057": "Ессентуки",
    "10828": "Ефремов",
    "11058": "Железноводск",
    "10710": "Железногорск",
    "11264": "Железногорск-Илимский",
    "11132": "Жигулёвск",
    "10956": "Жирновск",
    "10652": "Жуковка",
    "11356": "Забайкальск",
    "11378": "Завитинск",
    "11124": "Заинск",
    "10808": "Западная Двина",
    "10728": "Зарайск",
    "11098": "Заречный",
    "11240": "Заринск",
    "10729": "Звенигород",
    "216": "Зеленоград",
    "11125": "Зеленодольск",
    "11059": "Зеленокумск",
    "11040": "Зерноград",
    "11379": "Зея",
    "11265": "Зима",
    "11041": "Зимовники",
    "11202": "Златоуст",
    "11241": "Змеиногорск",
    "10947": "Знаменск",
    "10868": "Ивангород",
    "11380": "Ивановка",
    "5": "Иваново",
    "11305": "Игарка",
    "44": "Ижевск",
    "11281": "Ижморский",
    "11060": "Изобильный",
    "10957": "Иловля",
    "10941": "Инта",
    "11061": "Ипатово",
    "11163": "Ирбит",
    "63": "Иркутск",
    "10731": "Истра",
    "11173": "Ишим",
    "41": "Йошкар-Ола",
    "11413": "Кавалерово",
    "43": "Казань",
    "10677": "Калач",
    "10958": "Калач-на-Дону",
    "22": "Калининград",
    "6": "Калуга",
    "10809": "Калязин",
    "11099": "Каменка",
    "10869": "Каменногорск",
    "11042": "Каменоломни",
    "11164": "Каменск-Уральский",
    "11043": "Каменск-Шахтинский",
    "11242": "Камень-на-Оби",
    "11414": "Камень-Рыболов",
    "10662": "Камешково",
    "10959": "Камышин",
    "10895": "Кандалакша",
    "11307": "Канск",
    "10685": "Кантемировка",
    "11017": "Карачаевск",
    "10655": "Карачев",
    "10844": "Каргополь",
    "11203": "Карталы",
    "11357": "Карымское",
    "10773": "Касимов",
    "11204": "Касли",
    "11008": "Каспийск",
    "11205": "Катав-Ивановск",
    "11044": "Кашары",
    "10810": "Кашин",
    "10732": "Кашира",
    "11348": "Кедровый",
    "64": "Кемерово",
    "11464": "Керчь",
    "11157": "Кетово",
    "11206": "Кизильское",
    "11009": "Кизляр",
    "10829": "Кимовск",
    "10811": "Кимры",
    "10870": "Кингисепп",
    "11133": "Кинель",
    "10689": "Кинешма",
    "11267": "Киренск",
    "10663": "Киржач",
    "10871": "Кириши",
    "46": "Киров",
    "11071": "Кирово-Чепецк",
    "10872": "Кировск",
    "11415": "Кировский",
    "11283": "Киселёвск",
    "11062": "Кисловодск",
    "10960": "Клетская",
    "10733": "Клин",
    "10653": "Клинцы",
    "10664": "Ковров",
    "11180": "Когалым",
    "10695": "Козельск",
    "10734": "Коломна",
    "11349": "Колпашево",
    "11100": "Колышлей",
    "10665": "Кольчугино",
    "11453": "Комсомольск-на-Амуре",
    "10812": "Конаково",
    "10934": "Кондопога",
    "10696": "Кондрово",
    "11381": "Константиновка",
    "11046": "Константиновск",
    "11207": "Копейск",
    "11208": "Коркино",
    "11445": "Корсаков",
    "10845": "Коряжма",
    "10935": "Костомукша",
    "7": "Кострома",
    "10961": "Котельниково",
    "10846": "Котлас",
    "10962": "Котово",
    "10690": "Кохма",
    "11320": "Кош-Агач",
    "11284": "Крапивинский",
    "10666": "Красная Горбатка",
    "10994": "Красная Поляна",
    "10735": "Красногорск",
    "35": "Краснодар",
    "11358": "Краснокаменск",
    "11109": "Краснокамск",
    "11315": "Краснообск",
    "11165": "Краснотурьинск",
    "62": "Красноярск",
    "11045": "Красный Сулин",
    "10813": "Красный Холм",
    "10789": "Красный",
    "10914": "Крестцы",
    "10996": "Кропоткин",
    "10997": "Крымск",
    "11088": "Кувандык",
    "118515": "Кудрово",
    "11076": "Кудымкар",
    "11101": "Кузнецк",
    "10873": "Кузнечное",
    "11243": "Кулунда",
    "11113": "Кумертау",
    "10963": "Кумылженская",
    "53": "Курган",
    "11446": "Курильск",
    "8": "Курск",
    "11209": "Куса",
    "11166": "Кушва",
    "11333": "Кызыл",
    "11332": "Кызыл-Мажалык",
    "11210": "Кыштым",
    "10998": "Лазаревское",
    "11181": "Лангепас",
    "11126": "Лениногорск",
    "10964": "Ленинск",
    "11285": "Ленинск-Кузнецкий",
    "11435": "Ленск",
    "11167": "Лесной",
    "11416": "Лесозаводск",
    "10769": "Ливны",
    "9": "Липецк",
    "10678": "Лиски",
    "10814": "Лихославль",
    "10874": "Лодейное Поле",
    "10875": "Ломоносов",
    "10736": "Лотошино",
    "10876": "Луга",
    "11102": "Лунино",
    "10737": "Луховицы",
    "11417": "Лучегорск",
    "10738": "Люберцы",
    "10915": "Любытино",
    "79": "Магадан",
    "20181": "Магас",
    "11382": "Магдагачи",
    "235": "Магнитогорск",
    "1093": "Майкоп",
    "11321": "Майма",
    "10815": "Максатиха",
    "10909": "Малая Вишера",
    "10697": "Малоярославец",
    "11244": "Мамонтово",
    "10910": "Марёво",
    "11286": "Мариинск",
    "28": "Махачкала",
    "11182": "Мегион",
    "11287": "Междуреченск",
    "11183": "Междуреченский",
    "10667": "Меленки",
    "11212": "Миасс",
    "11213": "Миасское",
    "11047": "Миллерово",
    "11063": "Минеральные Воды",
    "11310": "Минусинск",
    "11436": "Мирный",
    "11245": "Михайловское",
    "10803": "Мичуринск",
    "11360": "Могоча",
    "10739": "Можайск",
    "11151": "Можга",
    "11022": "Моздок",
    "11103": "Мокшан",
    "10790": "Монастырщина",
    "10896": "Мончегорск",
    "11048": "Морозовск",
    "213": "Москва",
    "10911": "Мошенское",
    "11174": "Муравленко",
    "23": "Мурманск",
    "10668": "Муром",
    "10770": "Мценск",
    "11288": "Мыски",
    "10740": "Мытищи",
    "10836": "Мышкин",
    "236": "Набережные Челны",
    "11229": "Надым",
    "1092": "Назрань",
    "30": "Нальчик",
    "10741": "Наро-Фоминск",
    "11350": "Нарым",
    "10902": "Нарьян-Мар",
    "974": "Находка",
    "11064": "Невинномысск",
    "10816": "Нелидово",
    "10702": "Нерехта",
    "11361": "Нерчинск",
    "11437": "Нерюнгри",
    "11134": "Нефтегорск",
    "11114": "Нефтекамск",
    "11184": "Нефтеюганск",
    "10966": "Нехаевская",
    "1091": "Нижневартовск",
    "11127": "Нижнекамск",
    "11268": "Нижнеудинск",
    "11104": "Нижний Ломов",
    "47": "Нижний Новгород",
    "11168": "Нижний Тагил",
    "11169": "Нижняя Тура",
    "10967": "Николаевск",
    "11454": "Николаевск-на-Амуре",
    "11105": "Никольск",
    "11065": "Новоалександровск",
    "11246": "Новоалтайск",
    "10968": "Новоаннинский",
    "10654": "Новозыбков",
    "11383": "Новокиевский Увал",
    "237": "Новокузнецк",
    "11135": "Новокуйбышевск",
    "10830": "Новомосковск",
    "10969": "Новониколаевский",
    "11066": "Новопавловск",
    "11420": "Новопокровка",
    "970": "Новороссийск",
    "11089": "Новосергиевка",
    "65": "Новосибирск",
    "10771": "Новосиль",
    "11081": "Новосмолинский",
    "10930": "Новосокольники",
    "11090": "Новотроицк",
    "11170": "Новоуральск",
    "238": "Новочеркасск",
    "11049": "Новошахтинск",
    "10647": "Новый Оскол",
    "11230": "Новый Уренгой",
    "10742": "Ногинск",
    "11311": "Норильск",
    "11231": "Ноябрьск",
    "11128": "Нурлат",
    "11186": "Нягань",
    "11394": "Облучье",
    "967": "Обнинск",
    "10709": "Обоянь",
    "11317": "Обь",
    "10743": "Одинцово",
    "11214": "Озёрск",
    "10744": "Озёры",
    "11438": "Оймякон",
    "11136": "Октябрьск",
    "10970": "Октябрьский",
    "11215": "Октябрьское",
    "10912": "Окуловка",
    "11439": "Оленёк",
    "10817": "Оленино",
    "11363": "Оловянная",
    "10971": "Ольховка",
    "66": "Омск",
    "10847": "Онега",
    "10": "Орёл",
    "48": "Оренбург",
    "10745": "Орехово-Зуево",
    "11091": "Орск",
    "11290": "Осинники",
    "11401": "Оссора",
    "10818": "Осташков",
    "10679": "Острогожск",
    "10878": "Отрадное",
    "11137": "Отрадный",
    "11447": "Оха",
    "11455": "Охотск",
    "11082": "Павлово",
    "10746": "Павловский Посад",
    "11400": "Палана",
    "10972": "Палласовка",
    "10919": "Панковка",
    "11421": "Партизанск",
    "10916": "Парфино",
    "11460": "Певек",
    "49": "Пенза",
    "11092": "Первомайский",
    "11171": "Первоуральск",
    "10837": "Переславль-Залесский",
    "50": "Пермь",
    "10920": "Пестово",
    "10973": "Петров Вал",
    "11364": "Петровск-Забайкальский",
    "18": "Петрозаводск",
    "78": "Петропавловск-Камчатский",
    "10669": "Петушки",
    "10900": "Печенга",
    "10942": "Печора",
    "10931": "Печоры",
    "10879": "Пикалево",
    "10848": "Пинега",
    "11216": "Пласт",
    "11422": "Пограничный",
    "10921": "Поддорье",
    "10747": "Подольск",
    "10881": "Подпорожье",
    "11187": "Покачи",
    "11423": "Покровка",
    "11050": "Покровское",
    "11292": "Полысаево",
    "11248": "Поспелиха",
    "11138": "Похвистнево",
    "10791": "Починок",
    "11384": "Поярково",
    "10974": "Преображенская",
    "11365": "Приаргунск",
    "10882": "Приморск",
    "11000": "Приморско-Ахтарск",
    "10883": "Приозерск",
    "11291": "Прокопьевск",
    "11293": "Промышленная",
    "10648": "Прохоровка",
    "25": "Псков",
    "10884": "Пушкин",
    "10748": "Пушкино",
    "217": "Пущино",
    "11188": "Пыть-Ях",
    "11067": "Пятигорск",
    "11189": "Радужный",
    "11385": "Райчихинск",
    "10750": "Раменское",
    "11249": "Ребриха",
    "10820": "Ржев",
    "11250": "Родино",
    "11386": "Ромны",
    "10792": "Рославль",
    "10681": "Россошь",
    "10838": "Ростов",
    "39": "Ростов-на-Дону",
    "10885": "Рощино",
    "11251": "Рубцовск",
    "10751": "Руза",
    "10839": "Рыбинск",
    "10774": "Рыбное",
    "10707": "Рыльск",
    "10775": "Ряжск",
    "11": "Рязань",
    "11115": "Салават",
    "11294": "Салаир",
    "58": "Салехард",
    "11051": "Сальск",
    "51": "Самара",
    "2": "Санкт-Петербург",
    "11093": "Саракташ",
    "42": "Саранск",
    "11152": "Сарапул",
    "194": "Саратов",
    "11083": "Саров",
    "11334": "Сарыг-Сеп",
    "10777": "Сасово",
    "11217": "Сатка",
    "10794": "Сафоново",
    "11341": "Саяногорск",
    "11269": "Саянск",
    "10859": "Светлогорск",
    "11068": "Светлоград",
    "10976": "Светлый Яр",
    "10886": "Светогорск",
    "11387": "Свободный",
    "10932": "Себеж",
    "959": "Севастополь",
    "11327": "Северобайкальск",
    "10849": "Северодвинск",
    "11448": "Северо-Курильск",
    "10898": "Североморск",
    "11351": "Северск",
    "10936": "Сегежа",
    "11328": "Селенгинск",
    "10682": "Семилуки",
    "10977": "Серафимович",
    "10752": "Сергиев Посад",
    "11106": "Сердобск",
    "10753": "Серебряные Пруды",
    "11172": "Серов",
    "10754": "Серпухов",
    "10887": "Сертолово",
    "11388": "Серышево",
    "146": "Симферополь",
    "11389": "Сковородино",
    "10778": "Скопин",
    "11252": "Славгород",
    "11424": "Славянка",
    "10888": "Сланцы",
    "11073": "Слободской",
    "12": "Смоленск",
    "11218": "Снежинск",
    "10899": "Снежногорск",
    "10670": "Собинка",
    "11456": "Советская Гавань",
    "11110": "Соликамск",
    "10755": "Солнечногорск",
    "11094": "Соль-Илецк",
    "10922": "Сольцы",
    "10937": "Сортавала",
    "10891": "Сосновый Бор",
    "10943": "Сосногорск",
    "239": "Сочи",
    "10779": "Спас-Клепики",
    "11425": "Спасск-Дальний",
    "10978": "Средняя Ахтуба",
    "11366": "Сретенск",
    "36": "Ставрополь",
    "10979": "Старая Полтавка",
    "10923": "Старая Русса",
    "10821": "Старица",
    "10649": "Старый Оскол",
    "11116": "Стерлитамак",
    "11352": "Стрежевой",
    "10756": "Ступино",
    "10831": "Суворов",
    "11472": "Судак",
    "10708": "Суджа",
    "10671": "Суздаль",
    "973": "Сургут",
    "10980": "Суровикино",
    "11404": "Сусуман",
    "11139": "Сызрань",
    "19": "Сыктывкар",
    "10796": "Сычевка",
    "971": "Таганрог",
    "11270": "Тайшет",
    "10757": "Талдом",
    "10684": "Таловая",
    "11253": "Тальменка",
    "13": "Тамбов",
    "11390": "Тамбовка",
    "11295": "Таштагол",
    "14": "Тверь",
    "11018": "Теберда",
    "10901": "Териберка",
    "11014": "Терскол",
    "11440": "Тикси",
    "11296": "Тисуль",
    "10892": "Тихвин",
    "11002": "Тихорецк",
    "11175": "Тобольск",
    "240": "Тольятти",
    "67": "Томск",
    "11297": "Топки",
    "10822": "Торжок",
    "10823": "Торопец",
    "10893": "Тосно",
    "10855": "Тотьма",
    "11219": "Трёхгорный",
    "11220": "Троицк",
    "11254": "Троицкое",
    "1058": "Туапсе",
    "15": "Тула",
    "11271": "Тулун",
    "11372": "Тура",
    "11335": "Туран",
    "11322": "Турочак",
    "11313": "Туруханск",
    "11391": "Тында",
    "55": "Тюмень",
    "11298": "Тяжинский",
    "11221": "Увельский",
    "10840": "Углич",
    "11461": "Угольные Копи",
    "10797": "Угра",
    "10824": "Удомля",
    "10833": "Узловая",
    "11222": "Уйское",
    "198": "Улан-Удэ",
    "11367": "Улёты",
    "195": "Ульяновск",
    "11192": "Урай",
    "10981": "Урюпинск",
    "10944": "Усинск",
    "11272": "Усолье-Сибирское",
    "11426": "Уссурийск",
    "11019": "Усть-Джегута",
    "11273": "Усть-Илимск",
    "11255": "Усть-Калманка",
    "11399": "Усть-Камчатск",
    "11223": "Усть-Катав",
    "11323": "Усть-Кокса",
    "11354": "Усть-Ордынский",
    "10856": "Устюжна",
    "172": "Уфа",
    "10945": "Ухта",
    "11462": "Уэлен",
    "10711": "Фатеж",
    "11469": "Феодосия",
    "10982": "Фролово",
    "76": "Хабаровск",
    "57": "Ханты-Мансийск",
    "11011": "Хасавюрт",
    "11427": "Хасан",
    "11346": "Хатанга",
    "10917": "Хвойная",
    "11368": "Хилок",
    "10758": "Химки",
    "10798": "Хиславичи",
    "10924": "Холм",
    "10799": "Холм-Жирковский",
    "10850": "Холмогоры",
    "11428": "Хороль",
    "11052": "Цимлянск",
    "11336": "Чадан",
    "11141": "Чапаевск",
    "10714": "Чаплыгин",
    "11362": "Чара",
    "11224": "Чебаркуль",
    "45": "Чебоксары",
    "56": "Челябинск",
    "11274": "Черемхово",
    "968": "Череповец",
    "1104": "Черкесск",
    "11429": "Черниговка",
    "219": "Черноголовка",
    "11342": "Черногорск",
    "11369": "Чернышевск",
    "10983": "Чернышковский",
    "10760": "Черусти",
    "11226": "Чесма",
    "10761": "Чехов",
    "11129": "Чистополь",
    "68": "Чита",
    "11441": "Чокурдах",
    "11324": "Чоя",
    "11430": "Чугуевка",
    "10925": "Чудово",
    "11337": "Шагонар",
    "11159": "Шадринск",
    "10704": "Шарья",
    "10762": "Шатура",
    "10763": "Шаховская",
    "11053": "Шахты",
    "10780": "Шацк",
    "11325": "Шебалино",
    "11275": "Шелехов",
    "11107": "Шемышейка",
    "10851": "Шенкурск",
    "11371": "Шилка",
    "11392": "Шимановск",
    "10918": "Шимск",
    "11343": "Шира",
    "11442": "Шологонцы",
    "10800": "Шумячи",
    "10691": "Шуя",
    "10834": "Щекино",
    "10765": "Щелково",
    "1094": "Элиста",
    "10984": "Эльтон",
    "11147": "Энгельс",
    "11338": "Эрзин",
    "10683": "Эртиль",
    "11177": "Югорск",
    "11449": "Южно-Курильск",
    "80": "Южно-Сахалинск",
    "11227": "Южноуральск",
    "11299": "Юрга",
    "10692": "Юрьевец",
    "11431": "Яковлевка",
    "74": "Якутск",
    "11470": "Ялта",
    "11178": "Ялуторовск",
    "11075": "Яранск",
    "16": "Ярославль",
    "10801": "Ярцево",
    "11300": "Яшкино",
    "11301": "Яя",
}


DADATA_API_URL = "http://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address"
DADATA_API_KEY = os.getenv("DADATA_API_KEY")  # Замени на свой API-ключ
INDEX_NAME = "regions"


def enrich_regions(regions):
    """
    Функция для обогащения данных о регионах с помощью сервиса DaData
    """
    enriched_data = {}
    for region_id, region_name in regions.items():
        payload = {"query": region_name}
        headers = {"Authorization": f"Token {DADATA_API_KEY}"}

        response = httpx.post(DADATA_API_URL, json=payload, headers=headers)
        if response.status_code == 200:
            suggestions = response.json().get("suggestions", [])
            enriched_data[region_id] = suggestions[0] if suggestions else None
        else:
            enriched_data[region_id] = None

    return enriched_data


def save_to_jsonl(data):
    """
    Функция для сохранения данных в формате JSONL
    """
    with open("enriched_regions.jsonl", "w", encoding="utf-8") as f:
        for region_id, region_name in YA_REGIONS.items():
            json_line = json.dumps(
                {
                    "region_id": region_id,
                    "region_name": region_name,
                    "region_data": data.get(region_id),
                },
                ensure_ascii=False,
            )
            f.write(json_line + "\n")


def save_to_elasticsearch_from_file():
    """
    Функция для загрузки данных в Elasticsearch из файла jsonl
    """
    es = Elasticsearch(
        os.getenv("ELASTICSEARCH_HOST"),
        basic_auth=(os.getenv("ELASTIC_USERNAME"), os.getenv("ELASTIC_PASSWORD")),
    )
    with open("enriched_regions.jsonl", "r", encoding="utf-8") as f:
        bulk_data = []
        for line in f:
            record = json.loads(line)
            operation = {"index": {"_index": INDEX_NAME, "_id": record["region_id"]}}
            bulk_data.extend([json.dumps(operation), json.dumps(record)])

        if bulk_data:
            body = "\n".join(bulk_data) + "\n"
            es.bulk(body=body, index=INDEX_NAME)


if __name__ == "__main__":
    """
    Точка входа в программу
    """
    # enriched_regions = enrich_regions(YA_REGIONS)
    # save_to_jsonl(enriched_regions)
    # print("Данные сохранены в enriched_regions.jsonl")
    save_to_elasticsearch_from_file()
    print("Данные загружены в Elasticsearch")
